<apt-breadcrumb [label]="'CART.CREATE_ORDER' | translate" [breadcrumbs]="breadcrumbs" [autoGenerated]="false">
  <app-action-bar></app-action-bar>
</apt-breadcrumb>
<ng-container *ngIf="cart">
  <div class="container-fluid px-5 py-4" id="checkout-form">
    <h4 class="mb-3 text-muted">{{'CART.CREATE_ORDER' | translate}}</h4>
    <div *ngIf="!isPayForOrderEnabled; else paymentForm" class="row">
      <div class="col-md-4 order-md-2 mb-4">
        <apt-price-summary [paymentState]="paymentState" [record]="cart" [form]="form" [page]="pricingSummaryType"
          [loading]="loading" (onSubmitOrder)="submitOrder()" #priceSummary>
          <button type="button" class="btn btn-link cancel-button w-100" [routerLink]="['/carts/active']"
            data-style="zoom-in">{{'COMMON.CANCEL' | translate}}</button>
        </apt-price-summary>
        <cart-summary [cart]="cart"></cart-summary>
      </div>
      <div class="col-md-8 order-md-1">
        <form class="needs-validation" novalidate #form="ngForm">
          <div class="card p-3">
            <div class="pt-3 px-3">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <apt-input-field name="description" [labelClass]="'font-weight-normal'" [entity]="order"
                    [required]="true" [errorMsg]="errMessages.requiredOrderTitle" [field]="'Name'"
                    [(ngModel)]="order.Name" [label]="'COMMON.ORDER_TITLE' | translate">
                  </apt-input-field>
                </div>
                <div class="col-md-6 mb-3">
                  <apt-output-field [record]="order" field="PriceList" [labelClass]="'font-weight-normal'"
                    [editable]="false" [showQuickView]="true">
                  </apt-output-field>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <apt-output-field [record]="order" field="SoldToAccount" displayValue="SoldToAccount"
                    [labelClass]="'font-weight-normal'" [editable]="false" [showQuickView]="true">
                  </apt-output-field>
                </div>
                <div class="col-md-6 mb-3">
                  <apt-input-field name="primaryContact" [labelClass]="'font-weight-normal'" [entity]="order"
                    [field]="'PrimaryContact'" [(ngModel)]="order.PrimaryContact"
                    (ngModelChange)="onPrimaryContactChange()" [lookupOptions]="lookupOptions" [required]="true"
                    [errorMsg]="errMessages.requiredPrimaryContact">
                  </apt-input-field>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <apt-input-field name="billTo" [labelClass]="'font-weight-normal'" [entity]="order" [required]="true"
                    [errorMsg]="errMessages.requiredBillToAcc" [field]="'BillToAccount'"
                    [(ngModel)]="order.BillToAccount" (ngModelChange)="onBillToChange()">
                  </apt-input-field>
                  <div *ngIf="billToAccount$ | async as billAccount">
                    <apt-address [ngModel]="order?.BillToAccount" [type]="'Billing'" [readonly]="true"
                      name="billTo"></apt-address>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <apt-input-field name="shipTo" [labelClass]="'font-weight-normal'" [entity]="order"
                    [field]="'ShipToAccount'" [(ngModel)]="order.ShipToAccount" (ngModelChange)="onShipToChange()"
                    [required]="true" [errorMsg]="errMessages.requiredShipToAcc">
                  </apt-input-field>
                  <div *ngIf="shipToAccount$ | async as shipAccount">
                    <apt-address [ngModel]="order?.ShipToAccount" [type]="'Shipping'" [readonly]="true"
                      name="shipTo"></apt-address>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <ng-template #confirmationTemplate>
    <div class="modal-header align-items-center p-0 mx-4 mt-3 border-bottom border-secondary">
      <h6 class="modal-title pull-left font-weight-bold">
        {{'MANAGE_CART.CART_SUMMARY.CHECKOUT' | translate}}
      </h6>
      <button type="button" class="close pull-right" aria-label="Close" (click)="confirmationModal.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body d-flex flex-column justify-content-center py-4">
      <p class="text-center"><strong>{{ 'MODAL.THANK_YOU' | translate }}
          {{order?.PrimaryContact?.FirstName}}!</strong></p>
      <small class="text-center" *ngIf="order?.PrimaryContact?.Email; else noEmail"
        [translate]="'CART.SUCCESSFUL_ORDER_CREATION_MESSAGE'"
        [translateParams]="{emailAddress: order?.PrimaryContact?.Email}"></small>
      <h5 class="text-center my-3" [translate]="'DETAILS.GENERATED_ORDER_NUMBER'"
        [translateParams]="{orderName: orderConfirmation?.Name}"></h5>
      <button class="btn btn-outline-primary w-25 mx-auto" (click)="closeModal()">{{ 'DETAILS.VIEW_YOUR_ORDER' |
        translate }}</button>
    </div>
  </ng-template>

  <ng-template #noEmail>
    <small class="text-center">{{ 'CART.SUCCESSFUL_ORDER_CREATION_MESSAGE_WITHOUT_EMAIL' |
      translate }}</small>
  </ng-template>

</ng-container>